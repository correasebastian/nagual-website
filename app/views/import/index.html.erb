<div class="home flex flex-col flex-center">

  <section id="upload-zone" class='hide'>

    <div id="title-section">
      <h1>Import files into Nagual</h1>
      <h3>Drag and drop a CSV file to the space below</h3>
    </div>

    <div id="import-box">

      <div id="import-area" class="import-area-browse">
        <p class="copy">Drag your CSV file here or <a id="file-browse" href="#">click to browse</a></p>
        <input type="file" name="import-file" id="import-file">
      </div>

      <div id="importStatus" class="active">
        <h2 id="head-status"></h2>
        <p></p>
        <div class="loadFile">
          <div class="nameFile"></div>
          <div id="error-icon" class="fileIcon error-icon">
          </div>
          <div id="success-icon" class="fileIcon success-icon">
          </div>
        </div>
        <div class="progress">
          <div id="progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
          </div>
        </div>
      </div>
    </div>

    <div id="import-area-hide">
      <p id="hide-import-zone" class="copy">Hide</p>
    </div>
  </section>

  <section id="history-zone" class="container">
    <h2>Recent Jobs</h2>
    <%= link_to export_index_path, {id: 'export', class: 'btn-floating bg-white', target: '_blank'} do %>
        <span class="glyphicon glyphicon-cloud-download"></span>
    <% end %>
    <a id="show-import-area" class="btn-floating bg-white"><span class="glyphicon glyphicon-cloud-upload color-pink"></span></a>
    <table class="table table-hover">
      <thead>
      <tr>
        <th>Source File (CSV)</th>
        <th>Processed Date/time</th>
        <th>Processed records</th>
        <th>Status</th>
        <th>Error report</th>
      </tr>
      </thead>
      <tbody>
      <% @history.each do |entry| %>
          <tr>
            <td>
              <a href="<%= entry.processed_file_path %>">
                <%= File.basename(entry.processed_file_path) %>
              </a>
            </td>
            <td><%= entry.updated_at %></td>
            <td><%= entry.processed_records %></td>
            <td>
              <%= status_image(entry.status) %>
            </td>
            <td>
              <% if entry.status == 'error' %>
                  <a href="#" class="error-report-icon" data-url="<%= entry.report_file_path %>"><%= image_tag "report.png" %></a>
              <% end %>
            </td>
          </tr>
      <% end %>
      </tbody>
    </table>

    <div class="modal fade" id="error-report-modal" tabindex="-1" role="dialog" aria-labelledby="error-report-modal-label" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h2 class="modal-title" id="error-report-modal-title">Error report</h2>
            <p>Here is a list of errors found when we imported your file</p>
          </div>
          <div id="error-report-modal-body">
            <textarea class="error-report-modal-body-content"></textarea>
          </div>
        </div>
      </div>
    </div>

  </section>
</div>
